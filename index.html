<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Flow Designer</title>

    <!-- Favicon to prevent 404 error -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üé®</text></svg>">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/toolbar.css">
    <link rel="stylesheet" href="./css/sidebar.css">
    <link rel="stylesheet" href="./css/canvas.css">
    <link rel="stylesheet" href="./css/nodes.css">
    <link rel="stylesheet" href="./css/connections.css">
    <link rel="stylesheet" href="./css/statusbar.css">
    <link rel="stylesheet" href="./css/modals.css">
    <link rel="stylesheet" href="./css/metrics.css">
    <link rel="stylesheet" href="./css/properties.css">
    <link rel="stylesheet" href="./css/contextMenu.css">
    <link rel="stylesheet" href="./css/tutorial.css">
    <link rel="stylesheet" href="./css/responsive.css">
</head>
<body>
    <!-- Main Application Container -->
    <div id="app">
        <!-- Toolbar -->
        <div id="toolbar" class="toolbar">
            <div class="toolbar-section">
                <button id="btn-new" class="toolbar-btn" title="New Workflow (Ctrl+N)">
                    <span class="icon">üìÑ</span>
                    <span class="label">New</span>
                </button>
                <button id="btn-open" class="toolbar-btn" title="Open Workflow (Ctrl+O)">
                    <span class="icon">üìÇ</span>
                    <span class="label">Open</span>
                </button>
                <button id="btn-save" class="toolbar-btn" title="Save Workflow (Ctrl+S)">
                    <span class="icon">üíæ</span>
                    <span class="label">Save</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button id="btn-undo" class="toolbar-btn" title="Undo (Ctrl+Z)" disabled>
                    <span class="icon">‚Ü∂</span>
                    <span class="label">Undo</span>
                </button>
                <button id="btn-redo" class="toolbar-btn" title="Redo (Ctrl+Y)" disabled>
                    <span class="icon">‚Ü∑</span>
                    <span class="label">Redo</span>
                </button>
                <button id="btn-delete" class="toolbar-btn" title="Delete Selected (Del)">
                    <span class="icon">üóëÔ∏è</span>
                    <span class="label">Delete</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button id="btn-export-json" class="toolbar-btn" title="Export as JSON">
                    <span class="icon">üì•</span>
                    <span class="label">Export JSON</span>
                </button>
                <button id="btn-export-png" class="toolbar-btn" title="Export as PNG">
                    <span class="icon">üñºÔ∏è</span>
                    <span class="label">Export PNG</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button id="btn-auto-layout" class="toolbar-btn" title="Auto-Layout (Vertical)">
                    <span class="icon">üìê</span>
                    <span class="label">Auto-Layout</span>
                </button>
                <button id="btn-metrics" class="toolbar-btn" title="Show Metrics">
                    <span class="icon">üìä</span>
                    <span class="label">Metrics</span>
                </button>
                <button id="btn-theme-toggle" class="toolbar-btn" title="Toggle Dark Mode">
                    <span class="icon">üåì</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button id="btn-zoom-in" class="toolbar-btn" title="Zoom In (+)">
                    <span class="icon">üîç+</span>
                </button>
                <button id="btn-zoom-out" class="toolbar-btn" title="Zoom Out (-)">
                    <span class="icon">üîç-</span>
                </button>
                <button id="btn-zoom-reset" class="toolbar-btn" title="Reset Zoom (Ctrl+0)">
                    <span class="icon">‚Ü∫</span>
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button id="btn-help" class="toolbar-btn" title="Help & Keyboard Shortcuts (?)">
                    <span class="icon">‚ùì</span>
                    <span class="label">Help</span>
                </button>
            </div>

            <div class="toolbar-spacer"></div>

            <div class="toolbar-section">
                <span id="workflow-name" class="workflow-name" contenteditable="true" spellcheck="false">Untitled Workflow</span>
            </div>
        </div>

        <!-- Mobile sidebar toggle button and overlay -->
        <button id="mobile-sidebar-toggle" class="mobile-sidebar-toggle" aria-label="Toggle sidebar">&#9776;</button>
        <div id="mobile-sidebar-overlay" class="mobile-sidebar-overlay"></div>

        <!-- Main Content Area -->
        <div id="main-content" class="main-content">
            <!-- Sidebar with Node Palette -->
            <div id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <h3>Node Palette</h3>
                </div>
                <div class="sidebar-content">
                    <div class="node-palette">
                        <!-- Flow Control Category -->
                        <div class="palette-category">
                            <div class="palette-category-header">
                                <span class="category-icon">‚ñº</span>
                                <span class="category-title">Flow Control</span>
                            </div>
                            <div class="palette-category-content">
                                <div class="palette-node" data-node-type="start" draggable="true" title="Start - Entry point of the workflow">
                                    <svg width="60" height="60" class="palette-preview">
                                        <circle cx="30" cy="30" r="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                                        <text x="30" y="35" text-anchor="middle" fill="white" font-size="10">Start</text>
                                    </svg>
                                    <span class="palette-label">Start</span>
                                </div>

                                <div class="palette-node" data-node-type="end" draggable="true" title="End - Terminal point of the workflow">
                                    <svg width="60" height="60" class="palette-preview">
                                        <circle cx="30" cy="30" r="25" fill="#F44336" stroke="#C62828" stroke-width="2"/>
                                        <text x="30" y="35" text-anchor="middle" fill="white" font-size="10">End</text>
                                    </svg>
                                    <span class="palette-label">End</span>
                                </div>

                                <div class="palette-node" data-node-type="decision" draggable="true" title="Decision - Conditional branching point (if/else)">
                                    <svg width="60" height="60" class="palette-preview">
                                        <path d="M 30 5 L 55 30 L 30 55 L 5 30 Z" fill="#FFC107" stroke="#F57C00" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="#333" font-size="9">Decision</text>
                                    </svg>
                                    <span class="palette-label">Decision</span>
                                </div>

                                <div class="palette-node" data-node-type="merge" draggable="true" title="Merge - Convergence point for multiple paths">
                                    <svg width="60" height="60" class="palette-preview">
                                        <circle cx="30" cy="30" r="10" fill="#9E9E9E" stroke="#616161" stroke-width="2"/>
                                    </svg>
                                    <span class="palette-label">Merge</span>
                                </div>
                            </div>
                        </div>

                        <!-- Processes Category -->
                        <div class="palette-category">
                            <div class="palette-category-header">
                                <span class="category-icon">‚ñº</span>
                                <span class="category-title">Processes</span>
                            </div>
                            <div class="palette-category-content">
                                <div class="palette-node" data-node-type="task" draggable="true" title="Task - Single action or activity step">
                                    <svg width="60" height="60" class="palette-preview">
                                        <rect x="5" y="15" width="50" height="30" rx="4" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="white" font-size="10">Task</text>
                                    </svg>
                                    <span class="palette-label">Task</span>
                                </div>

                                <div class="palette-node" data-node-type="process" draggable="true" title="Process - Predefined subprocess or complex operation">
                                    <svg width="60" height="60" class="palette-preview">
                                        <rect x="5" y="15" width="50" height="30" rx="4" fill="#9C27B0" stroke="#7B1FA2" stroke-width="2"/>
                                        <line x1="12" y1="15" x2="12" y2="45" stroke="#7B1FA2" stroke-width="2"/>
                                        <line x1="48" y1="15" x2="48" y2="45" stroke="#7B1FA2" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="white" font-size="9">Process</text>
                                    </svg>
                                    <span class="palette-label">Process</span>
                                </div>

                                <div class="palette-node" data-node-type="manual" draggable="true" title="Manual - Manual task requiring human intervention">
                                    <svg width="60" height="60" class="palette-preview">
                                        <path d="M 12 15 L 48 15 L 55 45 L 5 45 Z" fill="#00BCD4" stroke="#0097A7" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="white" font-size="9">Manual</text>
                                    </svg>
                                    <span class="palette-label">Manual</span>
                                </div>

                                <div class="palette-node" data-node-type="delay" draggable="true" title="Delay - Waiting period or scheduled delay">
                                    <svg width="60" height="60" class="palette-preview">
                                        <path d="M 5 20 L 40 20 A 12 12 0 0 1 40 40 L 5 40 Z" fill="#607D8B" stroke="#455A64" stroke-width="2"/>
                                        <text x="25" y="33" text-anchor="middle" fill="white" font-size="9">Delay</text>
                                    </svg>
                                    <span class="palette-label">Delay</span>
                                </div>
                            </div>
                        </div>

                        <!-- Data Category -->
                        <div class="palette-category">
                            <div class="palette-category-header">
                                <span class="category-icon">‚ñº</span>
                                <span class="category-title">Data</span>
                            </div>
                            <div class="palette-category-content">
                                <div class="palette-node" data-node-type="database" draggable="true" title="Database - Data storage or database operation">
                                    <svg width="60" height="60" class="palette-preview">
                                        <ellipse cx="30" cy="20" rx="20" ry="8" fill="#FF9800" stroke="#F57C00" stroke-width="2"/>
                                        <rect x="10" y="20" width="40" height="20" fill="#FF9800" stroke="none"/>
                                        <line x1="10" y1="20" x2="10" y2="40" stroke="#F57C00" stroke-width="2"/>
                                        <line x1="50" y1="20" x2="50" y2="40" stroke="#F57C00" stroke-width="2"/>
                                        <ellipse cx="30" cy="40" rx="20" ry="8" fill="#FF9800" stroke="#F57C00" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="white" font-size="8">Database</text>
                                    </svg>
                                    <span class="palette-label">Database</span>
                                </div>

                                <div class="palette-node" data-node-type="document" draggable="true" title="Document - Paper document or file output">
                                    <svg width="60" height="60" class="palette-preview">
                                        <path d="M 10 15 L 50 15 L 50 40 Q 37 38 30 40 Q 23 42 10 40 Z" fill="#795548" stroke="#5D4037" stroke-width="2"/>
                                        <text x="30" y="30" text-anchor="middle" fill="white" font-size="8">Document</text>
                                    </svg>
                                    <span class="palette-label">Document</span>
                                </div>
                            </div>
                        </div>

                        <!-- Annotation Category -->
                        <div class="palette-category">
                            <div class="palette-category-header">
                                <span class="category-icon">‚ñº</span>
                                <span class="category-title">Annotation</span>
                            </div>
                            <div class="palette-category-content">
                                <div class="palette-node" data-node-type="comment" draggable="true" title="Note - Comments and annotations for documentation">
                                    <svg width="60" height="60" class="palette-preview">
                                        <path d="M 10 15 L 45 15 L 55 25 L 55 45 L 10 45 Z" fill="#FFEB3B" stroke="#FBC02D" stroke-width="2"/>
                                        <path d="M 45 15 L 45 25 L 55 25" fill="none" stroke="#FBC02D" stroke-width="2"/>
                                        <text x="30" y="33" text-anchor="middle" fill="#333" font-size="9">Note</text>
                                    </svg>
                                    <span class="palette-label">Note</span>
                                </div>
                            </div>
                        </div>

                        <!-- Connection Tool -->
                        <div class="palette-divider"></div>

                        <div id="connection-tool" class="palette-tool" data-tool="connect" title="Connect - Click to create connections between nodes (or just drag from node to node)">
                            <svg width="60" height="60" class="palette-preview">
                                <defs>
                                    <marker id="palette-arrow" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
                                        <polygon points="0 0, 8 3, 0 6" fill="#666"/>
                                    </marker>
                                </defs>
                                <circle cx="15" cy="30" r="8" fill="#999" stroke="#666" stroke-width="1"/>
                                <path d="M 23 30 L 37 30" stroke="#666" stroke-width="2" marker-end="url(#palette-arrow)"/>
                                <circle cx="45" cy="30" r="8" fill="#999" stroke="#666" stroke-width="1"/>
                            </svg>
                            <span class="palette-label">Connect</span>
                        </div>
                    </div>

                    <div class="sidebar-info">
                        <p class="info-text">Drag nodes onto the canvas to create your workflow</p>
                    </div>
                </div>
            </div>

            <!-- Canvas Area -->
            <div id="canvas-container" class="canvas-container">
                <svg id="canvas" class="canvas" xmlns="http://www.w3.org/2000/svg">
                    <!-- Definitions for arrowheads and patterns -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#666" />
                        </marker>
                        <marker id="arrowhead-selected" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#2196F3" />
                        </marker>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                        </pattern>
                    </defs>

                    <!-- Main group for zoom/pan transform -->
                    <g id="main-group">
                        <!-- Grid background -->
                        <rect id="grid-bg" x="-5000" y="-5000" width="10000" height="10000" fill="url(#grid)"/>

                        <!-- Connections layer -->
                        <g id="connections-layer"></g>

                        <!-- Nodes layer -->
                        <g id="nodes-layer"></g>

                        <!-- Temporary connection line (while dragging) -->
                        <line id="temp-connection" class="temp-connection" x1="0" y1="0" x2="0" y2="0"
                              stroke="#2196F3" stroke-width="2" stroke-dasharray="5,5"
                              marker-end="url(#arrowhead-selected)" style="display: none;"/>
                    </g>
                </svg>

                <!-- Canvas overlay for instructions -->
                <div id="canvas-overlay" class="canvas-overlay">
                    <div class="overlay-message">
                        <h2>üëã Welcome to Process Flow Designer</h2>
                        <p class="overlay-subtitle">Create professional workflow diagrams with ease</p>
                        <div class="quick-start-box">
                            <h3>Quick Start Guide</h3>
                            <ol class="quick-start-steps">
                                <li>Drag a <strong>Start</strong> node from the left palette</li>
                                <li>Add <strong>Task</strong> and <strong>Decision</strong> nodes</li>
                                <li>Connect nodes by dragging from one to another</li>
                                <li>Double-click to edit labels</li>
                                <li>Save your work with <kbd>Ctrl+S</kbd></li>
                            </ol>
                        </div>
                        <ul class="instructions">
                            <li>üñ±Ô∏è <strong>Pan:</strong> Space + Drag or Middle Mouse Button</li>
                            <li>üîç <strong>Zoom:</strong> Mouse Wheel or +/- buttons</li>
                            <li>üîó <strong>Connect:</strong> Drag from node to node</li>
                            <li>‚úèÔ∏è <strong>Edit:</strong> Double-click labels</li>
                            <li>‚ùì <strong>Help:</strong> Press <kbd>?</kbd> for keyboard shortcuts</li>
                        </ul>
                        <p class="overlay-footer">üí° Your workflow is auto-saved every 5 seconds</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar" class="status-bar">
            <div class="status-section" title="Total number of nodes in the workflow">
                <span class="status-label">Nodes:</span>
                <span id="status-nodes">0</span>
            </div>
            <div class="status-divider"></div>
            <div class="status-section" title="Total number of connections in the workflow">
                <span class="status-label">Connections:</span>
                <span id="status-connections">0</span>
            </div>
            <div class="status-divider"></div>
            <div class="status-section" title="Current zoom level (use mouse wheel or +/- to adjust)">
                <span class="status-label">Zoom:</span>
                <span id="status-zoom">100%</span>
            </div>
            <div class="status-divider"></div>
            <div class="status-section" title="Current application status">
                <span id="status-message" class="status-message">Ready</span>
            </div>
            <div class="status-section status-right">
                <span id="status-autosave" class="status-autosave">‚óè</span>
                <span class="status-label">Auto-saved</span>
            </div>
        </div>
    </div>

    <!-- Hidden file input for importing -->
    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- Toast notification container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modal for confirmations -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Confirm</h3>
            </div>
            <div class="modal-body">
                <p id="modal-message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="modal-confirm" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.19/dist/interact.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Application Modules (ES6 Modules) -->
    <script type="module" src="./js/app.js"></script>
</body>
</html>
